(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{146:function(t,e,n){"use strict";e.a={methods:{footer:function(){$("#mailContent").height()<$(window).height()?this.$store.commit("changeFooterFixed",!0):this.$store.commit("changeFooterFixed",!1)}}}},148:function(t,e,n){"use strict";var r=n(11),o=n(150),c=n.n(o);c.a.interceptors.response.use(function(t){return t.data?t.data:{}},function(t){return Promise.reject(t)});var h=c.a;n.d(e,"f",function(){return d}),n.d(e,"h",function(){return y}),n.d(e,"g",function(){return f}),n.d(e,"d",function(){return v}),n.d(e,"n",function(){return m}),n.d(e,"i",function(){return x}),n.d(e,"a",function(){return w}),n.d(e,"e",function(){return L}),n.d(e,"c",function(){return C}),n.d(e,"m",function(){return S}),n.d(e,"j",function(){return k}),n.d(e,"b",function(){return B}),n.d(e,"l",function(){return _}),n.d(e,"k",function(){return M});var l="production api",d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h.get("".concat(l,"article/get"),{params:t})},y=function(t){return h.get("".concat(l,"article/get/").concat(t))},f=function(){return h.get("".concat(l,"article/getAll"))},v=function(t){return h.post("".concat(l,"article/like/").concat(t))},m=function(){return h.get("".concat(l,"tag/get"))},x=function(t){return h.get("".concat(l,"comment/get"),{params:t})},w=function(t){return h.put("".concat(l,"comment/add"),Object(r.a)({},t))},L=function(t){return h.post("".concat(l,"comment/like/").concat(t))},C=function(t){return h.put("".concat(l,"reply/add"),Object(r.a)({},t))},S=function(t){return h.get("".concat(l,"reply/get/").concat(t))},k=function(t){return h.get("".concat(l,"hero/get"),{params:t})},B=function(t){return h.put("".concat(l,"hero/add"),Object(r.a)({},t))},_=function(t){return h.get("".concat(l,"project/get"),{params:t})},M=function(t){return h.get("".concat(l,"music/get"),{params:t})}},161:function(t,e,n){},208:function(t,e,n){"use strict";var r=n(161);n.n(r).a},216:function(t,e,n){"use strict";n.r(e);n(44);var r=n(5),o=n(146),c=n(148);n(73);function h(t){var e=t.substring(1,t.length).split(":");return parseFloat(60*e[0])+parseFloat(e[1])}n(94),n(16),n(202);var l=n(206),d=n(207),y=512,f=64,v=(Math.floor,Math.round,Math.random),m=Math.sin,x=Math.cos,w=Math.PI,L=2*w,C=w/180,S=0,k=0,B=0,_=function t(e,n,r){var o,c;Object(d.a)(this,t),this.x=Math.random()*n-S,this.y=Math.random()*r-k,this.z=this.max_depth=Math.max(n/r),this.radius=.2,o=this.x>0?1:-1,c=this.y>0?1:-1,Math.abs(this.x)>Math.abs(this.y)?(this.dx=1,this.dy=Math.abs(this.y/this.x)):(this.dx=Math.abs(this.x/this.y),this.dy=1),this.dx*=o,this.dy*=c,this.dz=-.1,this.ddx=.001*this.dx,this.ddy=.001*this.dy,this.y>k/2?this.color="#B5BFD4":this.color=e>110?"#B5BFD4":e>140?"#F451BA":"#465677",o=c=null},M=function(){function t(e){Object(d.a)(this,t),this.index=e.index,this.angle=360*this.index/y,this.updateDynamics(e.w,e.h),this.value=256*Math.random(),this.dx=this.x+this.value*m(C*this.angle),this.dy=this.y+this.value*x(C*this.angle)}return Object(l.a)(t,[{key:"updateDynamics",value:function(t,e){this.radius=Math.abs(t,e)/10,this.x=S+this.radius*m(C*this.angle),this.y=k+this.radius*x(C*this.angle)}}]),t}(),D=function(){function t(e){Object(d.a)(this,t),this.index=e.index,this.angle=360*this.index/f,this.updateDynamics(e.w,e.h),this.value=256*Math.random(),this.dx=this.x+this.value*m(C*this.angle),this.dy=this.y+this.value*x(C*this.angle)}return Object(l.a)(t,[{key:"updateDynamics",value:function(t,e){this.radius=Math.abs(t,e)/10,this.x=S+this.radius*m(C*this.angle),this.y=k+this.radius*x(C*this.angle)}}]),t}(),P=function(){function t(e,n,r,o,c){Object(d.a)(this,t),this.analyser=n,this.ctx=e,this.stars=[],this.points=[],this.avg_points=[],this.w=r,this.h=o,this.playing=!1,this.frequencyDataLength=n.frequencyBinCount,this.frequencyData=new Uint8Array(this.frequencyDataLength),this.timeData=new Uint8Array(this.frequencyDataLength),this.cb=c,this.init()}return Object(l.a)(t,[{key:"init",value:function(){this.resizeHandler(),this.createStarField(),this.createPoints(),this.clearCanvas(),this.drawStarField(),this.drawAverageCircle(),this.drawWaveform()}},{key:"updatePlaying",value:function(b){this.playing=b}},{key:"createStarField",value:function(){for(var i=-1;++i<1500;)this.stars.push(new _(this.avg,this.w,this.h));this.catchOriginStart=JSON.parse(JSON.stringify(this.stars)),i=null}},{key:"createPoints",value:function(){for(var t=this.w,e=this.h,i=-1;++i<y;)this.points.push(new M({index:i+1,w:t,h:e}));for(i=-1;++i<f;)this.avg_points.push(new D({index:i+1,w:t,h:e}));i=null}},{key:"getAvg",value:function(t){var e=0;return t.forEach(function(t){e+=t}),e/t.length}},{key:"animate",value:function(){if(this.playing){var t=this.analyser,e=this.getAvg,n=this.frequencyData,r=this.timeData;requestAnimationFrame(this.animate.bind(this)),t.getByteFrequencyData(n),t.getByteTimeDomainData(r),this.avg=e([].slice.call(n)),this.clearCanvas(),this.drawStarField(),this.drawAverageCircle(),this.drawWaveform(),this.cb&&this.cb()}}},{key:"clearCanvas",value:function(){var t=this.ctx,e=this.w,n=this.h,r=t.createLinearGradient(0,0,0,n);r.addColorStop(0,"#000011"),r.addColorStop(.96,"#060D1F"),r.addColorStop(1,"#02243F"),t.beginPath(),t.globalCompositeOperation="source-over",t.fillStyle=r,t.fillRect(0,0,e,n),t.fill(),t.closePath(),r=null}},{key:"drawStarField",value:function(){var i,t,p,e,n=this.stars,r=this.avg,o=this.ctx,c=this.catchOriginStart,h=this.w,l=this.h;for(i=0,t=n.length;i<t;i++)(p=n[i]).x=p.x||c[i].x,p.y=p.y||c[i].y,e=r>100?r/20:r/50,p.x+=p.dx*e,p.y+=p.dy*e,p.z+=p.dz,p.dx+=p.ddx,p.dy+=p.ddy,p.radius=.2+.1*(p.max_depth-p.z),p.x<-S||p.x>S||p.y<-k||p.y>k?n[i]=new _(r,h,l):(o.beginPath(),o.globalCompositeOperation="lighter",o.fillStyle=p.color,o.arc(p.x+S,p.y+k,p.radius,L,!1),o.fill(),o.closePath());i=t=p=e=null}},{key:"drawAverageCircle",value:function(){var i,t,p,e,n,r,o=this.avg,c=this.ctx,h=this.avg_points;for(o>100?(B+=-.001,e=o+10*v(),c.strokeStyle="rgba(77, 218, 248, 1)",c.fillStyle="rgba(29, 36, 57, 0.05)"):(B+=.001,e=o,c.strokeStyle="rgba(77, 218, 248, 1)",c.fillStyle="rgba(29, 36, 57, 0.1)"),c.beginPath(),c.lineWidth=1,c.lineCap="round",c.save(),c.translate(S,k),c.rotate(B),c.translate(-S,-k),c.moveTo(h[0].dx,h[0].dy),i=0,t=f;i<t-1;i++)(p=h[i]).dx=p.x+e*m(C*p.angle),p.dy=p.y+e*x(C*p.angle),n=(p.dx+h[i+1].dx)/2,r=(p.dy+h[i+1].dy)/2,c.quadraticCurveTo(p.dx,p.dy,n,r);(p=h[i]).dx=p.x+e*m(C*p.angle),p.dy=p.y+e*x(C*p.angle),n=(p.dx+h[0].dx)/2,r=(p.dy+h[0].dy)/2,c.quadraticCurveTo(p.dx,p.dy,n,r),c.quadraticCurveTo(n,r,h[0].dx,h[0].dy),c.stroke(),c.fill(),c.restore(),c.closePath(),i=t=p=e=n=r=null}},{key:"drawWaveform",value:function(){var i,t,p,e,n,r,o=this.avg,c=this.ctx,h=this.points,l=this.timeData;for(o>100?(B+=.05,c.strokeStyle="rgba(157, 242, 157, 0.8)",c.fillStyle="rgba(0,0,0,0)"):(B+=-.05,c.strokeStyle="rgba(157, 242, 157, 0.11)",c.fillStyle="rgba(29, 36, 57, 0.05)"),c.beginPath(),c.lineWidth=1,c.lineCap="round",c.save(),c.translate(S,k),c.rotate(B),c.translate(-S,-k),c.moveTo(h[0].dx,h[0].dy),i=0,t=y;i<t-1;i++)p=h[i],e=l[i],p.dx=p.x+e*m(C*p.angle),p.dy=p.y+e*x(C*p.angle),n=(p.dx+h[i+1].dx)/2,r=(p.dy+h[i+1].dy)/2,c.quadraticCurveTo(p.dx,p.dy,n,r);e=l[i],(p=h[i]).dx=p.x+e*m(C*p.angle),p.dy=p.y+e*x(C*p.angle),n=(p.dx+h[0].dx)/2,r=(p.dy+h[0].dy)/2,c.quadraticCurveTo(p.dx,p.dy,n,r),c.quadraticCurveTo(n,r,h[0].dx,h[0].dy),c.stroke(),c.fill(),c.restore(),c.closePath(),i=t=p=e=n=r=null}},{key:"resizeHandler",value:function(){var t=this.ctx,e=this.w,n=this.h,r=this.avg_points,o=this.points;S=e/2,k=n/2,t.canvas.width=e,t.canvas.height=n,o.forEach(function(p){p.updateDynamics()}),r.forEach(function(p){p.updateDynamics()})}}]),t}(),A={head:{title:"naice | 音乐",meta:[{hid:"description",name:"description",content:"naice | 音乐"}]},layout:"music-layout",data:function(){return{music:[],lyricArr:[],playing:!1,musicLink:"",text1:"",text2:"",playIndex:0,showLyric:!1,poster:"",showAllBtn:!1,showlyricScroll:!1,lyricScrollY:0,isScrolling:!1,showList:!1}},mixins:[o.a],computed:{showBtns:function(){return!this.showLyric}},methods:{initDom:function(){var t=this.$refs;this.play=t.play,this.pause=t.pause,this.next=t.next,this.prev=t.prev,this.canvas=t.canvas,this.audio=t.audio,this.musicBox=t.musicBox,this.lyriList=t.lyriList,this.lyricScrollBar=t.lyricScrollBar,this.musicList=t.musicList,this.musicListBox=t.musicListBox,this.init(),this.initCanvas(),this.initLyricScroll()},init:function(){this.ctx=this.canvas.getContext("2d"),this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.source=this.audioCtx.createMediaElementSource(this.audio),this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=1024,this.analyser.minDecibels=-100,this.analyser.maxDecibels=-30,this.analyser.smoothingTimeConstant=.8,this.analyser.connect(this.audioCtx.destination),this.source.connect(this.analyser)},initCanvas:function(){var t=this,e=this.ctx,n=this.analyser,r=this.musicBox,canvas=this.canvas,o=r.offsetWidth,c=r.offsetHeight;canvas.width=o,canvas.height=c,canvas.style.width=o+"px",canvas.style.height=c+"px",this.musicDraw=new P(e,n,o,c,this.getLineLyric),this.audio.onended=function(){t.toNext()},this.poster=this.music[0]?this.music[0].poster:""},toPlay:function(){var t=this;this.playing?this.toPause():this.musicLink?this.audioCtx.resume().then(function(){t.audio.play(),t.playing=!0,t.musicDraw.updatePlaying(t.playing),t.musicDraw.animate()}):this.loadMusic()},toPause:function(){this.audio.pause(),this.playing=!1,this.musicDraw.updatePlaying(this.playing)},toNext:function(){this.playIndex+=1,this.playIndex===this.music.length&&(this.playIndex=0),this.loadMusic()},toPrev:function(){this.playIndex-=1,this.playIndex<=0&&(this.playIndex=0),this.loadMusic()},selectMusic:function(t){this.playIndex=t,this.loadMusic(),this.showList=!1},btnMousrenter:function(){this.showAllBtn=!0},btnMouseleave:function(){this.showAllBtn=!1},loadMusic:function(){var t,e,n=this,r=this.music[this.playIndex];this.musicLink!==r.url&&(this.toPause(),this.musicLink=r.url,this.poster=r.poster,this.lyricArr=(t=r.lyrics,e=[],t&&(e=t.split("[").reduce(function(t,e){var n=e.trim().split("]");return n[1]&&t.push({time:h(n[0]),text:n[1]}),t},[])),e),this.audio.onloadedmetadata=function(){n.toPlay()})},toList:function(){this.showList=!this.showList},toLyric:function(){this.showLyric=!0},hideLyric:function(){this.showLyric=!1},getLineLyric:function(){var audio=this.audio,t=this.lyricArr,e=this.lyriList,n=function(time,t){for(var e=t.length-1,i=0;i<e;i++)if(time<=t[i].time)return i;return e}(audio.currentTime,t);n>0&&(n-=1),this.text2=t[n].text,this.text1!==this.text2&&(e.style.transform="translate3d(0, ".concat(32*-n,"px,0)")),this.text1=this.text2},initLyricScroll:function(){var t=this.music,e=this.lyricScrollBar;this.ah=41*t.length,0===this.ah?this.showlyricScroll=!1:this.ah>400&&(this.lyricScrollBarHeight=16e4/this.ah,e.style.height=this.lyricScrollBarHeight+"px",this.showlyricScroll=!0,this.initLyricScrollEvernt())},initLyricScrollEvernt:function(){var t=this,e=this.lyricScrollBar,n=this.musicListBox,r=0,o=400-this.lyricScrollBarHeight,c=0,h=0,l=function(){h<=0?(h=0,c++):h>o?(h=o,c++):c=0,c<=2&&(t.lyricScrollBar.style.transform="translateY(".concat(h,"px)"),t.musicList.style.transform="translateY(".concat(-h/400*t.ah,"px)"))},d=function(e){var n=e.clientY-r;h=t.lyricScrollY+n,t.isScrolling=!0,l()},y=function e(n){t.lyricScrollY=h,t.isScrolling=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",e)};e.addEventListener("mousedown",function(e){r=e.clientY,t.isScrolling=!1,document.addEventListener("mousemove",d),document.addEventListener("mouseup",y)}),n.addEventListener("mousewheel",function(e){e.preventDefault(),e.stopPropagation(),h=t.lyricScrollY+e.deltaY,l(),t.lyricScrollY=h})}},mounted:function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(){var e,n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(c.k)();case 2:e=t.sent,this.music=e.result||[],this.$nextTick(function(){n.initDom(),n.footer()});case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),beforeDestroy:function(){this.ctx=null,this.audioCtx=null,this.source=null,this.analyser=null}},O=(n(208),n(8)),component=Object(O.a)(A,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"musicBox",staticClass:"musicBox"},[n("div",{staticClass:"oparations"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showLyric,expression:"showLyric"}],staticClass:"lyricBox abs"},[n("div",{staticClass:"topMask",on:{click:t.hideLyric}}),t._v(" "),n("div",{staticClass:"bottomMask",on:{click:t.hideLyric}}),t._v(" "),n("div",{staticClass:"lyriList"},[n("ul",{ref:"lyriList"},[t._l(t.lyricArr,function(e,r){return n("li",{key:r},[t._v(t._s(e.text))])}),t._v(" "),0===t.lyricArr.length?n("li",[t._v("大侠，请点击播放加载歌词吧...")]):t._e()],2)])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showBtns,expression:"showBtns"}],staticClass:"musicBtnBox abs",on:{mouseenter:t.btnMousrenter,mouseleave:t.btnMouseleave}},[n("transition",{attrs:{name:"slide-fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showAllBtn,expression:"showAllBtn"}],staticClass:"musicBtns"},[n("span",{staticClass:"btnList pbtn",on:{click:t.toList}},[n("i",{staticClass:"iconfont"},[t._v("")])]),t._v(" "),n("span",{staticClass:"btnLyric pbtn",on:{click:t.toLyric}},[n("i",{staticClass:"iconfont"},[t._v("")])]),t._v(" "),n("span",{ref:"play",staticClass:"btnPlay pbtn",on:{click:t.toPlay}},[n("i",{staticClass:"iconfont"},[t._v(t._s(t.playing?"":""))])]),t._v(" "),n("span",{ref:"prev",staticClass:"btnPrev pbtn",on:{click:t.toPrev}},[n("i",{staticClass:"iconfont"},[t._v("")])]),t._v(" "),n("span",{ref:"next",staticClass:"btnNext pbtn",on:{click:t.toNext}},[n("i",{staticClass:"iconfont"},[t._v("")])])])]),t._v(" "),n("transition",{attrs:{name:"poster-fade"}},[t.poster?n("img",{directives:[{name:"show",rawName:"v-show",value:!t.showAllBtn,expression:"!showAllBtn"}],attrs:{src:t.poster}}):t._e()])],1)]),t._v(" "),n("canvas",{ref:"canvas",staticClass:"musicCanvas",attrs:{width:"1000",height:"800"}},[t._v("您的浏览器不支持canvas标签")]),t._v(" "),n("audio",{ref:"audio",staticStyle:{display:"none"},attrs:{src:t.musicLink,crossOrigin:"anonymous"}},[t._v("您的浏览器不支持audio标签")]),t._v(" "),n("transition",{attrs:{name:"list-fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showList,expression:"showList"}],ref:"musicListBox",staticClass:"musicList"},[n("ul",{ref:"musicList"},t._l(t.music,function(e,r){return n("li",{key:e._id,on:{click:function(e){return t.selectMusic(r)}}},[t._v(t._s(e.title)+"("+t._s(e.name)+")")])}),0),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showlyricScroll,expression:"showlyricScroll"}],staticClass:"lyricScroll"},[n("div",{ref:"lyricScrollBar",staticClass:"lyricScrollBar",class:t.isScrolling?"active":""})])])])],1)},[],!1,null,"3ad53f66",null);e.default=component.exports}}]);